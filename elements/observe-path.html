<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="import-commons.html">
<link rel="import" href="import-observe.html">

<script>
  Polymer({
    is: "observe-path",
    properties: {
      data: {
        type: Object,
        notify: true,
        observer: "_onRootChanged"
      },
      path: String,
      value: {
        type: Object,
        notify: true,
        computed: "getValue(dummy)"
      }
    },
    _fire: function(newValue, oldValue) {
      this.notifyPath("value", newValue);
    },
    _onRootChanged: function(newValue, oldValue) {
      if (this._observer) this._observer.close();
      if (!newValue) return;
      if (!this.path) return;

      var observable = newValue;
      if (andiwand.isString(newValue)) {
        observable = andiwand.byPath(window, newValue);
        if (!observable) return;
      }

      this._observer = new PathObserver(observable, this.path);
      this._observer.open($.proxy(function(newValue, oldValue) {
        this._fire(newValue, oldValue);
      }), this);

      this._fire(andiwand.byPath(observable, this.path), undefined);
    },
    getValue: function() {
      return this.value;
    }
  });
</script>
