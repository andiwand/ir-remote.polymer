<link rel="import" href="../libs/polymer/polymer.html">
<link rel="import" href="../libs/iron-icons/iron-icons.html">
<link rel="import" href="../libs/iron-icons/hardware-icons.html">
<link rel="import" href="../libs/iron-icons/editor-icons.html">
<link rel="import" href="../libs/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../libs/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../libs/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../libs/paper-icon-button/paper-icon-button.html">
<link rel="import" href="import-jquery.html">
<link rel="import" href="global-variable.html">
<link rel="import" href="dialog-button.html">
<link rel="import" href="dialog-cast.html">
<link rel="import" href="remote-container.html">

<dom-module id="app-page-remote">
  <style>
  </style>

  <template>
    <global-variable id="global" key="page-remote"></global-variable>
    <global-variable key="main" value="{{main}}"></global-variable>

    <dialog-button id="dialog-button" on-accept="buttonDialogAccept"></dialog-button>
    <dialog-cast id="dialog-cast"></dialog-cast>

    <paper-header-panel>
      <paper-toolbar>
        <paper-icon-button icon="arrow-back" on-click="back"></paper-icon-button>
        <div class="title">Remote</div>
        <paper-icon-button on-click="cast" icon="hardware:cast" hidden="{{editable}}"></paper-icon-button>
        <paper-icon-button on-click="buttonAdd" icon="add-circle" hidden="{{!editable}}"></paper-icon-button>
        <paper-icon-button on-click="editStart" icon="editor:mode-edit" hidden="{{editable}}"></paper-icon-button>
        <paper-icon-button on-click="editEnd" icon="done" hidden="{{!editable}}"></paper-icon-button>
      </paper-toolbar>
    </paper-header-panel>

    <div class="page">
      <remote-container id="remote" on-button="buttonClick"></remote-container>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: "app-page-remote",
    properties: {
      editable: {
        type: Boolean,
        notify: true,
        value: true
      },
    },
    ready: function() {
      this.$.global.value = this;
    },
    load: function(remote) {
      this.remote = remote;
      this.$.remote.load(remote.ui);
    },
    cast: function() {
      this.$.dialogCast.open();
    },
    back: function() {
      this.$.remote.destroy();

      // TODO: other solution?
      window.setTimeout($.proxy(function() {
        this.main.page = "main";
      }, this), 0);
    },
    setEditable: function(editable) {
      this.$.remote.setEditable(editable);
      this.editable = editable;
    },
    editStart: function() {
      this.setEditable(true);
    },
    editEnd: function() {
      this.setEditable(false);

      var ui = this.$.remote.save();
      this.remote.ui = ui;
    },
    buttonAdd: function() {
      this.$.remote.addButton();
    },
    buttonClick: function(event) {
      if (this.editable) {
        var button = event.detail;
        this.buttonDialogOpen(button);
      } else {
        console.log("send");
      }
    },
    buttonDialogOpen: function(button) {
      var dialog = this.$["dialog-button"];
      dialog.set(button);
      dialog.button = button;
      dialog.open();
    },
    buttonDialogAccept: function() {
      var dialog = this.$["dialog-button"];
      var button = dialog.button ? dialog.button : {};

      dialog.get(button);
      dialog.close();
    }
  });
</script>
